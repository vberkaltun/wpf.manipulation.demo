<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <Target Name="UpdateManifestVersion" AfterTargets="GetVersion" Condition="'$(Configuration)' == 'Release'">

        <PropertyGroup>
            <!-- Ensure BuildMetaData has a value -->
            <GitVersion_BuildMetaData>$(GitVersion_PreReleaseNumber)</GitVersion_BuildMetaData>
            <GitVersion_BuildMetaData Condition="'$(GitVersion_BuildMetaData)' == ''">0</GitVersion_BuildMetaData>

            <ManifestVersion>$(GitVersion_MajorMinorPatch).$(GitVersion_BuildMetaData)</ManifestVersion>
            
            <AppxPackageManifestFile>$(MSBuildThisFileDirectory)Package.appxmanifest</AppxPackageManifestFile>
            <AssemblyManifestFile>$(MSBuildThisFileDirectory)app.manifest</AssemblyManifestFile>
        </PropertyGroup>

        <!-- Update the version in the *.appxmanifest -->
        <XmlPoke Condition="Exists('$(AppxPackageManifestFile)')"
                 XmlInputPath="$(AppxPackageManifestFile)"
                 Query="/dn:Package/dn:Identity/@Version"
                 Value="$(ManifestVersion)"
                 Namespaces="&lt;Namespace Prefix='dn' Uri='http://schemas.microsoft.com/appx/manifest/foundation/windows10' /&gt;" />
        <!-- Update the version in the *.manifest -->
        <XmlPoke Condition="Exists('$(AssemblyManifestFile)')"
                 XmlInputPath="$(AssemblyManifestFile)"
                 Query="/dn:assembly/dn:assemblyIdentity/@version"
                 Value="$(ManifestVersion)"
                 Namespaces="&lt;Namespace Prefix='dn' Uri='urn:schemas-microsoft-com:asm.v1' /&gt;" />

        <!-- Print a success message -->
        <Message Text="Updated AppX manifest version to: $(ManifestVersion)" Importance="High" />

    </Target>
</Project>
